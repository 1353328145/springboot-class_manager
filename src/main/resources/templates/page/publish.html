<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="../../css/layui.css" media="all">
</head>
<body>
    <div class="layui-container">
        <div class="layui-row" style="margin-top: 20px  ">
            <div class="layui-col-md4">
                <form class="layui-form" action="">
                    <div class="layui-form-item">
                        <label class="layui-form-label">公告主题</label>
                        <div class="layui-input-block">
                            <input type="text" id = "theme" placeholder="请输入" autocomplete="off" class="layui-input" lay-verify="required">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <textarea id="content" style="display: none;"></textarea>
                    </div>
                    <div class="layui-form-item">
                        <button type="button" class="layui-btn layui-btn-radius layui-btn-fluid" onclick="save()">提交信息</button>
                    </div>
                </form>
            </div>
            <div class="layui-col-md1">&nbsp;</div>
            <div class="layui-col-md7">
                <table class="layui-table" lay-even lay-skin="nob" lay-size="lg" id="notices"
                       lay-filter="tableData"></table>
            </div>
        </div>
    </div>
</body>
<script src="../../layui.js" charset="utf-8"></script>
<script type="text/html" id="do">
    <div class="layui-btn-group">
        <button type="button" class="layui-btn layui-btn-sm">
            <i class="layui-icon">&#xe642;</i>
        </button>
        <button type="button" class="layui-btn layui-btn-sm">
            <i class="layui-icon">&#xe640;</i>
        </button>
    </div>
</script>
<script>
    let layedit;
    let index;
    let $;
    let layer;
    let table;
    layui.use(['form','layer','jquery','layedit','table'], function(){
        table = layui.table;
        layedit = layui.layedit;
        $ = layui.jquery;
        index = layedit.build('content',{
            height: 300 ,//设置编辑器高度
            tool:[
                'strong' //加粗
                ,'italic' //斜体
                ,'underline' //下划线
                ,'del' //删除线
                ,'|' //分割线
                ,'left' //左对齐
                ,'center' //居中对齐
                ,'right' //右对齐
                ,'link' //超链接
                ,'unlink' //清除链接
                ,'face' //表情
            ]
        }); //建立编辑器
        layer = layui.layer;
        table.render({
            elem:'#notices'
            ,id:'noticeTable'
            ,url:'notice/load'
            ,height: 315 //容器高度
            ,method: 'get'
            ,page: true
            ,where :{
                query: '',

            }
            ,cols: [
                [
                    {field: 'createTime', title: '时间', width:160},
                    {field: 'theme', title: '主题', width:160},
                    {templet:'<div>{{ d.user.name }}</div>', title: '管理员', width:120},
                    {templet:'<div>{{ d.user.pn }}</div>', title: '电话', width:120},
                    {templet:'#do', title: '操作',},
                ]
            ] //设置表头
        });
    });
    function save() {
        $.ajax({
            url:'notice/save',
            method:'post',
            data:{
                uid:window.sessionStorage.getItem("uid"),
                theme: $("#theme").val(),
                content: layedit.getContent(index)
            },
            success:function (data) {
                if (data.success){
                    layer.msg("保存成功！")
                } else{
                    layer.msg("保存失败！")
                }
            },
            error:function () {
                layer.msg("服务器出错了。。")
            }
        })
    }
</script>
<style>

</style>
</html>
